<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Toko Mekar Mandiri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#2e7d32;
  --bg:#f4f6f8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI, Arial;
  background:var(--bg);
}
header{
  background:linear-gradient(135deg,#2e7d32,#43a047);
  color:#fff;
  padding:20px;
  text-align:center;
}
.container{
  padding:15px;
  padding-bottom:230px;
}
.category h3{color:var(--primary)}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:12px;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:12px;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}
.price{color:var(--primary);font-weight:bold}
.qty{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin-top:8px;
}
.qty button{
  width:30px;
  height:30px;
  border:none;
  background:var(--primary);
  color:#fff;
  border-radius:50%;
  font-size:18px;
}
.cart{
  position:fixed;
  bottom:0;left:0;right:0;
  background:#fff;
  border-top:2px solid var(--primary);
  padding:12px;
}
button{
  background:var(--primary);
  border:none;
  color:#fff;
  padding:10px;
  border-radius:8px;
  width:100%;
  margin-top:6px;
}
select{
  width:100%;
  padding:8px;
  border-radius:6px;
  margin-top:6px;
}
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  align-items:center;
  justify-content:center;
}
.modal-content{
  background:#fff;
  padding:16px;
  border-radius:14px;
  width:90%;
  max-width:360px;
  text-align:center;
}
</style>
</head>

<body>

<header>
  <h2>Toko Mekar Mandiri</h2>
  <p>Sembako & Klontong</p>
</header>

<div class="container" id="produkList"></div>

<div class="cart">
  <pre id="cartText">üõí Keranjang kosong</pre>
  <div id="totalHarga"><b>Total: Rp0</b></div>
  <select id="pembayaran">
    <option>COD</option>
    <option>Transfer Bank</option>
    <option>QRIS</option>
  </select>
  <button onclick="checkout()">Checkout</button>
</div>

<!-- MODAL QRIS -->
<div class="modal" id="qrisModal">
  <div class="modal-content">
    <h3>üí≥ Pembayaran QRIS</h3>
    <p id="qrisTotal"></p>
    <img src="qris.jpg" style="width:100%;border-radius:10px">
    <button onclick="konfirmasi()">Saya sudah bayar</button>
    <button onclick="closeQRIS()" style="background:#ccc;color:#000">Tutup</button>
  </div>
</div>

<!-- MODAL STRUK -->
<div class="modal" id="strukModal">
  <div class="modal-content">
    <h3>üßæ STRUK</h3>
    <div id="strukItem"></div>
    <p id="strukTotal"></p>
    <p id="strukBayar"></p>
    <button onclick="printBT()">üñ®Ô∏è Cetak Bluetooth</button>
    <button onclick="kirimWA()">üì≤ Kirim WhatsApp</button>
    <button onclick="closeStruk()">Selesai</button>
  </div>
</div>

<script>
/* ========= KONFIG ========= */
const whatsapp="6285162808162";

/* ========= DATA ========= */
const data={
  "Sembako":[
    {nama:"Beras Medium",harga:14000},
    {nama:"Beras Super",harga:15500},
    {nama:"Gula Pasir",harga:17500},
    {nama:"Minyak Goreng 1L",harga:17500}
  ],
  "Kebutuhan":[
    {nama:"Mie Instan",harga:3000},
    {nama:"Sabun Mandi",harga:5000}
  ]
};

let cart=[];
let antrian=Number(localStorage.getItem("antrian")||0);

/* ========= RENDER PRODUK ========= */
const produkList=document.getElementById("produkList");

for(let k in data){
  let sec=document.createElement("div");
  sec.className="category";
  sec.innerHTML=<h3>${k}</h3><div class="grid"></div>;
  let grid=sec.querySelector(".grid");

  data[k].forEach(p=>{
    let id=p.nama.replace(/\s/g,'');
    let card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <h4>${p.nama}</h4>
      <div class="price">Rp${p.harga.toLocaleString()}</div>
      <div class="qty">
        <button onclick="kurang('${p.nama}')">‚àí</button>
        <span id="qty-${id}">0</span>
        <button onclick="tambah('${p.nama}',${p.harga})">+</button>
      </div>`;
    grid.appendChild(card);
  });
  produkList.appendChild(sec);
}

/* ========= CART ========= */
function tambah(nama,harga){
  let item=cart.find(p=>p.nama===nama);
  if(item) item.qty++;
  else cart.push({nama,harga,qty:1});
  updateQty(nama);
  render();
}
function kurang(nama){
  let item=cart.find(p=>p.nama===nama);
  if(!item) return;
  item.qty--;
  if(item.qty<=0) cart=cart.filter(p=>p.nama!==nama);
  updateQty(nama);
  render();
}
function updateQty(nama){
  let id="qty-"+nama.replace(/\s/g,'');
  let item=cart.find(p=>p.nama===nama);
  document.getElementById(id).innerText=item?item.qty:0;
}
function render(){
  let text="",total=0;
  cart.forEach(p=>{
    let sub=p.qty*p.harga;
    text+=‚Ä¢ ${p.nama} x${p.qty} = Rp${sub.toLocaleString()}\n;
    total+=sub;
  });
  cartText.innerText=text||"üõí Keranjang kosong";
  totalHarga.innerHTML="<b>Total: Rp"+total.toLocaleString()+"</b>";
}

/* ========= CHECKOUT ========= */
function checkout(){
  if(cart.length===0) return alert("Keranjang kosong");
  let total=cart.reduce((a,b)=>a+b.qty*b.harga,0);
  if(pembayaran.value==="QRIS"){
    qrisTotal.innerText="Total: Rp"+total.toLocaleString();
    qrisModal.style.display="flex";
  }else konfirmasi();
}
function konfirmasi(){
  closeQRIS();
  tampilkanStruk();
}

/* ========= STRUK ========= */
function tampilkanStruk(){
  antrian++;
  localStorage.setItem("antrian",antrian);

  let html="",total=0;
  cart.forEach(p=>{
    let sub=p.qty*p.harga;
    html+=${p.nama} x${p.qty} = Rp${sub.toLocaleString()}<br>;
    total+=sub;
  });
  html+=<br>No Antrian: <b>${antrian}</b>;
  strukItem.innerHTML=html;
  strukTotal.innerHTML="<b>Total: Rp"+total.toLocaleString()+"</b>";
  strukBayar.innerHTML="Pembayaran: "+pembayaran.value;
  strukModal.style.display="flex";
}

/* ========= WHATSAPP ========= */
function kirimWA(){
  let msg="üßæ STRUK TOKO MEKAR MANDIRI%0A";
  let total=0;
  cart.forEach(p=>{
    msg+=‚Ä¢ ${p.nama} x${p.qty}%0A;
    total+=p.qty*p.harga;
  });
  msg+=%0ATotal: Rp${total.toLocaleString()}%0APembayaran: ${pembayaran.value};
  window.open(https://wa.me/${whatsapp}?text=${msg});
}

/* ========= BLUETOOTH PRINT ========= */
function printBT(){
  let total=0;
  let text="TOKO MEKAR MANDIRI\n";
  text+="--------------------------\n";
  cart.forEach(p=>{
    let sub=p.qty*p.harga;
    text+=${p.nama}\n ${p.qty} x ${p.harga} = ${sub}\n;
    total+=sub;
  });
  text+="--------------------------\n";
  text+=TOTAL : ${total}\n;
  text+=BAYAR : ${pembayaran.value}\n;
  text+=ANTRI : ${antrian}\n;
  text+=new Date().toLocaleString("id-ID")+"\n";
  text+="Terima kasih\n\n";

  window.location.href=
    "intent://print/#Intent;scheme=rawbt;package=ru.a402d.rawbtprinter;S.text="+
    encodeURIComponent(text)+";end";
}

/* ========= UTIL ========= */
function closeStruk(){
  strukModal.style.display="none";
  cart=[];
  render();
  document.querySelectorAll("[id^=qty-]").forEach(e=>e.innerText="0");
}
function closeQRIS(){qrisModal.style.display="none";}
</script>

</body>
</html>
