<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Toko Mekar Mandiri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f4f6f8;
}
header{
  background:#2e7d32;
  color:white;
  text-align:center;
  padding:20px;
}
#product-list{
  padding:15px;
  padding-bottom:220px;
}
.product{
  background:white;
  border-radius:12px;
  padding:12px;
  margin-bottom:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
.price{
  color:#2e7d32;
  font-weight:bold;
}
.qty{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:10px;
}
.qty button{
  width:30px;
  height:30px;
  border:none;
  background:#2e7d32;
  color:white;
  border-radius:50%;
  font-size:18px;
}
.cart{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:white;
  border-top:2px solid #2e7d32;
  padding:12px;
}
button.checkout{
  background:#2e7d32;
  color:white;
  border:none;
  width:100%;
  padding:12px;
  border-radius:8px;
  margin-top:6px;
}
select{
  width:100%;
  padding:8px;
  margin-top:6px;
}
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  align-items:center;
  justify-content:center;
}
.modal-content{
  background:white;
  padding:16px;
  border-radius:12px;
  width:90%;
  max-width:320px;
  text-align:center;
}
</style>
</head>

<body>

<header>
  <h2>Toko Mekar Mandiri</h2>
  <p>Sembako & Klontong</p>
</header>

<div id="product-list"></div>

<div class="cart">
  <div id="cartText">ðŸ›’ Keranjang kosong</div>
  <b id="totalText">Total: Rp0</b>
  <select id="pay">
    <option>COD</option>
    <option>Transfer</option>
    <option>QRIS</option>
  </select>
  <button class="checkout" onclick="checkout()">Checkout</button>
</div>

<!-- MODAL QRIS -->
<div class="modal" id="qrisModal">
  <div class="modal-content">
    <h3>Bayar QRIS</h3>
    <p id="qrisTotal"></p>
    <img src="qris.jpg" style="width:100%">
    <button class="checkout" onclick="confirm()">Saya sudah bayar</button>
    <button onclick="closeQRIS()">Tutup</button>
  </div>
</div>

<!-- MODAL STRUK -->
<div class="modal" id="strukModal">
  <div class="modal-content">
    <h3>STRUK</h3>
    <div id="strukData"></div>
    <button class="checkout" onclick="sendWA()">Kirim WA</button>
    <button onclick="closeStruk()">Selesai</button>
  </div>
</div>

<script>
const whatsapp="6285162808162";

const data={
  "Sembako":[
    {nama:"Beras Medium",harga:14000},
    {nama:"Beras Super",harga:15500},
    {nama:"Gula Pasir",harga:17500},
    {nama:"Minyak Goreng 1L",harga:17500}
  ],
  "Kebutuhan":[
    {nama:"Mie Instan",harga:3000},
    {nama:"Sabun Mandi",harga:5000}
  ]
};

let cart=[];
let antrian=Number(localStorage.getItem("antrian")||0);

const produkList=document.getElementById("produkList");

for(let k in data){
  let sec=document.createElement("div");
  sec.className="category";
  sec.innerHTML=`<h3>${k}</h3><div class="grid"></div>`;
  let grid=sec.querySelector(".grid");

  data[k].forEach(p=>{
    let id=p.nama.replace(/\s/g,'');
    let card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <h4>${p.nama}</h4>
      <div class="price">Rp${p.harga.toLocaleString()}</div>
      <div class="qty">
        <button onclick="kurang('${p.nama}')">âˆ’</button>
        <span id="qty-${id}">0</span>
        <button onclick="tambah('${p.nama}',${p.harga})">+</button>
      </div>`;
    grid.appendChild(card);
  });
  produkList.appendChild(sec);
}

function tambah(nama,harga){
  let item=cart.find(p=>p.nama===nama);
  if(item) item.qty++;
  else cart.push({nama,harga,qty:1});
  updateQty(nama);
  render();
}
function kurang(nama){
  let item=cart.find(p=>p.nama===nama);
  if(!item) return;
  item.qty--;
  if(item.qty<=0) cart=cart.filter(p=>p.nama!==nama);
  updateQty(nama);
  render();
}
function updateQty(nama){
  let id="qty-"+nama.replace(/\s/g,'');
  let item=cart.find(p=>p.nama===nama);
  document.getElementById(id).innerText=item?item.qty:0;
}
function render(){
  let text="",total=0;
  cart.forEach(p=>{
    let sub=p.qty*p.harga;
    text+=`â€¢ ${p.nama} x${p.qty} = Rp${sub.toLocaleString()}\n`;
    total+=sub;
  });
  cartText.innerText=text||"ðŸ›’ Keranjang kosong";
  totalHarga.innerHTML="<b>Total: Rp"+total.toLocaleString()+"</b>";
}

function checkout(){
  if(cart.length===0) return alert("Keranjang kosong");
  let total=cart.reduce((a,b)=>a+b.qty*b.harga,0);
  if(pembayaran.value==="QRIS"){
    qrisTotal.innerText="Total: Rp"+total.toLocaleString();
    qrisModal.style.display="flex";
  }else konfirmasi();
}
function konfirmasi(){
  closeQRIS();
  tampilkanStruk();
}

function tampilkanStruk(){
  antrian++;
  localStorage.setItem("antrian",antrian);

  let html="",total=0;
  cart.forEach(p=>{
    let sub=p.qty*p.harga;
    html+=`${p.nama} x${p.qty} = Rp${sub.toLocaleString()}<br>`;
    total+=sub;
  });
  html+=`<br>No Antrian: <b>${antrian}</b>`;
  strukItem.innerHTML=html;
  strukTotal.innerHTML="<b>Total: Rp"+total.toLocaleString()+"</b>";
  strukBayar.innerHTML="Pembayaran: "+pembayaran.value;
  strukModal.style.display="flex";
}

function kirimWA(){
  let msg="ðŸ§¾ STRUK TOKO MEKAR MANDIRI%0A";
  let total=0;
  cart.forEach(p=>{
    msg+=`â€¢ ${p.nama} x${p.qty}%0A`;
    total+=p.qty*p.harga;
  });
  msg+=`%0ATotal: Rp${total.toLocaleString()}%0APembayaran: ${pembayaran.value}`;
  window.open(`https://wa.me/${whatsapp}?text=${msg}`);
}

function printBT(){
  let total=0;
  let text="TOKO MEKAR MANDIRI\n--------------------------\n";
  cart.forEach(p=>{
    let sub=p.qty*p.harga;
    text+=`${p.nama}\n ${p.qty} x ${p.harga} = ${sub}\n`;
    total+=sub;
  });
  text+=`--------------------------\nTOTAL : ${total}\nBAYAR : ${pembayaran.value}\nANTRI : ${antrian}\n`;
  text+=new Date().toLocaleString("id-ID")+"\nTerima kasih\n\n";

  window.location.href=
    "intent://print/#Intent;scheme=rawbt;package=ru.a402d.rawbtprinter;S.text="+
    encodeURIComponent(text)+";end";
}

function closeStruk(){
  strukModal.style.display="none";
  cart=[];
  render();
  document.querySelectorAll("[id^=qty-]").forEach(e=>e.innerText="0");
}
function closeQRIS(){qrisModal.style.display="none";}
</script>

</body>
</html>











